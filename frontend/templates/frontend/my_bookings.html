{% extends 'frontend/base.html' %}

{% block title %}My Bookings | Bus Reservation System{% endblock %}

{% block content %}
<div class="container mt-5">

    <h2 class="mb-4 text-center">My Bookings</h2>

    {% if bookings %}

    <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle text-center">
            <thead class="table-dark">
            <tr>
                <th>#</th>
                <th>Bus</th>
                <th>Route</th>
                <th>Seat</th>
                <th>Status</th>
                <th>Payment</th>
                <th>Departure</th>
                <th>Arrival</th>
                <th>Price (Rs.)</th>
                <th>Actions</th>
            </tr>
            </thead>

            <tbody>
            {% for booking in bookings %}
            <tr>

                <td>{{ forloop.counter }}</td>

                <td>
                    {{ booking.trip.bus.bus_number }}<br>
                    <small class="text-muted">{{ booking.trip.bus.type_of_bus }}</small>
                </td>

                <td>
                    {{ booking.trip.route.location_from }} â†’ {{ booking.trip.route.location_to }}
                </td>

                <td><strong>{{ booking.seat_number }}</strong></td>

                <!-- Booking Status -->
                <td>
                    {% if booking.is_cancelled %}
                        <span class="badge bg-danger">Cancelled</span>
                    {% elif booking.is_confirmed %}
                        <span class="badge bg-success">Confirmed</span>
                    {% else %}
                        <span class="badge bg-warning text-dark">Pending</span>
                    {% endif %}
                </td>

                <!-- Payment Status -->
                <td>
                    {% if booking.payment_status == 'paid' %}
                        <span class="badge bg-success">Paid</span>
                    {% elif booking.payment_status == 'pending' %}
                        <span class="badge bg-warning text-dark">Pending</span>
                    {% elif booking.payment_status == 'refunded' %}
                        <span class="badge bg-info">Refunded</span>
                    {% else %}
                        <span class="badge bg-danger">Failed</span>
                    {% endif %}
                </td>

                <td>{{ booking.trip.departure_time|date:"Y-m-d H:i" }}</td>
                <td>{{ booking.trip.arrival_time|date:"Y-m-d H:i" }}</td>

                <td>{{ booking.trip.price }}</td>

                <!-- Actions -->
                <td>
                    {% if booking.payment_status == 'pending' and not booking.is_cancelled and booking.trip.departure_time > now %}
                        <a href="{% url 'payment-page' booking.id %}" class="btn btn-sm btn-primary mb-1">
                            Pay Now
                        </a>
                    {% endif %}

                    {% if not booking.is_cancelled and booking.trip.departure_time > now %}
                        <a href="{% url 'cancel-booking-page' booking.id %}" class="btn btn-sm btn-danger mb-1">
                            Cancel
                        </a>
                    {% endif %}

                    {% if booking.trip.departure_time <= now %}
                        <span class="badge bg-secondary">Trip Passed</span>
                    {% endif %}
                </td>

            </tr>
            {% endfor %}
            </tbody>

        </table>
    </div>

    {% else %}
    <div class="alert alert-info text-center">
        <h5>No bookings yet ðŸ˜”</h5>
        <p>Go to Trips and book your first seat!</p>
        <a href="{% url 'trips-page' %}" class="btn btn-primary mt-2">Browse Trips</a>
    </div>
    {% endif %}

</div>
{% endblock %}
